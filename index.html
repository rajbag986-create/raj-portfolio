<script>
/* ========= CONFIG ========= */
const PASSWORD = "raj123";

/* ========= ADMIN ELEMENTS ========= */
const adminBtn = document.getElementById("adminBtn");
const loginBox = document.getElementById("login");
const loginBtn = document.getElementById("loginBtn");
const adminBox = document.getElementById("admin");

/* ========= POST ELEMENTS ========= */
const publishBtn = document.getElementById("publishBtn");
const postInput = document.getElementById("postText");
const privateCheckbox = document.getElementById("privatePost");
const postsDiv = document.getElementById("posts");

/* ========= STATE ========= */
let isAdmin = false;
let posts = JSON.parse(localStorage.getItem("posts")) || [];

/* ========= ADMIN LOGIN ========= */
adminBtn.addEventListener("click", () => {
  loginBox.style.display = "block";
  loginBox.scrollIntoView({ behavior: "smooth" });
});

loginBtn.addEventListener("click", () => {
  const pass = document.getElementById("adminPass").value;

  if (pass === PASSWORD) {
    isAdmin = true;
    loginBox.style.display = "none";
    adminBox.style.display = "block";
    adminBox.scrollIntoView({ behavior: "smooth" });
    alert("âœ… Admin Login Successful");
    renderPosts();
  } else {
    alert("âŒ Wrong Password");
  }
});

/* ========= ADD POST ========= */
publishBtn.addEventListener("click", () => {
  const text = postInput.value.trim();
  if (!text) return;

  posts.unshift({
    text,
    private: privateCheckbox.checked
  });

  localStorage.setItem("posts", JSON.stringify(posts));
  postInput.value = "";
  privateCheckbox.checked = false;
  renderPosts();
});

/* ========= RENDER POSTS ========= */
function renderPosts() {
  postsDiv.innerHTML = "";

  posts.forEach((post, index) => {
    if (post.private && !isAdmin) return;

    const div = document.createElement("div");
    div.className = "post";

    div.innerHTML = `
      <p>${post.text}</p>
      ${
        isAdmin
          ? `<button onclick="editPost(${index})">âœï¸ Edit</button>
             <button onclick="deletePost(${index})">ğŸ—‘ï¸ Delete</button>`
          : ""
      }
    `;

    postsDiv.appendChild(div);
  });
}

/* ========= DELETE ========= */
function deletePost(index) {
  if (!confirm("Delete this post?")) return;
  posts.splice(index, 1);
  localStorage.setItem("posts", JSON.stringify(posts));
  renderPosts();
}

/* ========= EDIT ========= */
function editPost(index) {
  const newText = prompt("Edit post:", posts[index].text);
  if (!newText) return;

  posts[index].text = newText;
  localStorage.setItem("posts", JSON.stringify(posts));
  renderPosts();
}

/* ========= INITIAL LOAD ========= */
renderPosts();

/* ========= CONTACT FORM (NO REDIRECT) ========= */
const form = document.getElementById("contactForm");
const successMsg = document.getElementById("successMsg");

form.addEventListener("submit", async (e) => {
  e.preventDefault(); // âŒ stop redirect

  try {
    const formData = new FormData(form);

    const res = await fetch(form.action, {
      method: "POST",
      body: formData,
      headers: { Accept: "application/json" }
    });

    if (res.ok) {
      form.reset();
      successMsg.style.display = "block";

      // â±ï¸ 5 sec à¦ªà¦°à§‡ hide
      setTimeout(() => {
        successMsg.style.display = "none";
      }, 5000);
    } else {
      alert("âŒ Submission failed");
    }
  } catch (err) {
    alert("âŒ Network error");
  }
});
</script>
